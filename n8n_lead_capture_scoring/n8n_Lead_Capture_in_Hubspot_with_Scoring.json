{
  "name": "Lead Capture in Hubspot with Scoring",
  "nodes": [
    {
      "parameters": {
        "formId": "DJUUTAmq"
      },
      "id": "8f79216b-2b12-4098-b375-c70bce4e2311",
      "name": "Typeform Trigger",
      "type": "n8n-nodes-base.typeformTrigger",
      "typeVersion": 1,
      "position": [
        -432,
        -272
      ],
      "webhookId": "4a3f9983-b137-408b-bb59-7ec526f97365",
      "credentials": {
        "typeformApi": {
          "id": "tNSwaT0iHzSMO7YQ",
          "name": "tA's Typeform account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "appToken",
        "operation": "search",
        "filterGroupsUi": {
          "filterGroupsValues": [
            {
              "filtersUi": {
                "filterValues": [
                  {
                    "propertyName": "email|string",
                    "value": "={{ $json.Email }}"
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "id": "17064ca5-077c-49f4-b2f5-1d8dc8688a3f",
      "name": "Search HubSpot Contact",
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2,
      "position": [
        -208,
        -272
      ],
      "alwaysOutputData": true,
      "credentials": {
        "hubspotAppToken": {
          "id": "3VUB860zpdVt2DkG",
          "name": "HubSpot App Token account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09FGEUHVR9",
          "mode": "list",
          "cachedResultName": "tf_lead"
        },
        "text": "=🚀 *New Lead Alert!*  \n👤 Name: {{ $json.firstname }} {{ $json.lastname }}\n📧 Email: {{ $json.email }} \n🏢 Company: {{ $json.company }} \n📊 Score: {{ $json.leadScore }} — {{ $json.leadTier }}\n\n",
        "otherOptions": {}
      },
      "id": "d9bcd04d-1081-4924-9072-7d3bdd66ba7f",
      "name": "Slack Notification",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2,
      "position": [
        688,
        -272
      ],
      "webhookId": "c9848548-9a95-4da0-b23e-cebabedd22d3",
      "credentials": {
        "slackOAuth2Api": {
          "id": "ntTzsGmt8PVJZSJL",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f7b2cddc-e3d3-417e-8976-f885f09d0374",
              "leftValue": "={{ $json.properties.email }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        16,
        -272
      ],
      "id": "2683bba4-24bf-4829-b3ae-880a810f7fa7",
      "name": "If"
    },
    {
      "parameters": {
        "authentication": "appToken",
        "email": "={{ $json.properties.email }}",
        "additionalFields": {
          "companyName": "={{ $('Set Field').item.json.Company }}",
          "firstName": "={{ $('Set Field').item.json['First name'] }}",
          "lastName": "={{ $('Set Field').item.json['Last name'] }}",
          "phoneNumber": "={{ $('Set Field').item.json['Phone number'] }}"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2.2,
      "position": [
        240,
        -176
      ],
      "id": "db204ea8-7e8b-428a-81e4-8dcc427fcb10",
      "name": "Update a contact",
      "credentials": {
        "hubspotAppToken": {
          "id": "3VUB860zpdVt2DkG",
          "name": "HubSpot App Token account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "appToken",
        "email": "={{ $('Typeform Trigger').item.json.Email }}",
        "additionalFields": {
          "companyName": "={{ $('Typeform Trigger').item.json.Company }}",
          "firstName": "={{ $('Typeform Trigger').item.json['First name'] }}",
          "lastName": "={{ $('Typeform Trigger').item.json['Last name'] }}",
          "phoneNumber": "={{ $('Typeform Trigger').item.json['Phone number'] }}"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.hubspot",
      "typeVersion": 2.2,
      "position": [
        240,
        -368
      ],
      "id": "0072205b-5bba-4501-8e4c-640e45eb39d8",
      "name": "Create a contact",
      "credentials": {
        "hubspotAppToken": {
          "id": "3VUB860zpdVt2DkG",
          "name": "HubSpot App Token account"
        }
      }
    },
    {
      "parameters": {
        "content": "Typeform trigger captures lead data fillled",
        "height": 96,
        "width": 176,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -464,
        -416
      ],
      "typeVersion": 1,
      "id": "20280495-5d1a-449b-9da0-7043a25ec7c1",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "Checks and deduplicate data before creating a new contact",
        "height": 112,
        "width": 176,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -256,
        -64
      ],
      "typeVersion": 1,
      "id": "eb29d7a5-0452-4d2e-b475-6f6e1ecf9071",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "If contact isn't available in Hubspot CRM, a contact is created",
        "height": 112,
        "width": 192,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        16,
        -464
      ],
      "typeVersion": 1,
      "id": "d6169b09-8f12-4356-8a1b-fd94c2830a24",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "If contact is available in Hubspot CRM, it updates existing contact",
        "height": 112,
        "width": 192,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        -80
      ],
      "typeVersion": 1,
      "id": "2b3c10a7-a9f8-4d82-b598-d47d4696d150",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "Function code checks and assigns a score based on defined rules",
        "height": 112,
        "width": 192,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        432,
        -448
      ],
      "typeVersion": 1,
      "id": "a86fb201-a389-4234-8377-daf6729ea4f3",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "Finally, it triggers new lead alert with status as - Cold, Warm, & Hot ",
        "height": 112,
        "width": 192,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        928,
        -288
      ],
      "typeVersion": 1,
      "id": "aa203c82-8227-4778-9a6a-2f47bf856c9c",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "jsCode": "const data = items[0].json; // full contact JSON\nconst props = data.properties || {};\nlet score = 0;\n\n// Rule 1: Conversion events\nif (parseInt(props.num_unique_conversion_events?.value || \"0\") > 0) {\n  score += 30;\n}\n\n// Rule 2: Page views\nif (parseInt(props.hs_analytics_num_page_views?.value || \"0\") > 5) {\n  score += 20;\n}\n\n// Rule 3: Visits\nif (parseInt(props.hs_analytics_num_visits?.value || \"0\") > 2) {\n  score += 20;\n}\n\n// Rule 4: Email domain check\nconst email = props.email?.value || \"\";\nif (email && !/(gmail\\.com|yahoo\\.com|outlook\\.com|hotmail\\.com)$/i.test(email)) {\n  score += 20;\n}\n\n// Rule 5: Phone present\nif (props.phone?.value || props.mobilephone?.value) {\n  score += 10;\n}\n\n// Rule 6: Company enriched\nif (data[\"associated-company\"]?.properties?.hs_is_enriched?.value === \"true\") {\n  score += 20;\n}\n\n// Rule 7: Lifecycle stage\nif ((props.lifecyclestage?.value || \"\").toLowerCase() === \"lead\") {\n  score += 10;\n}\n\n// --- Lead Tiers ---\nlet tier = \"❄️ Cold Lead\";\nif (score >= 70) {\n  tier = \"🔥 Hot Lead\";\n} else if (score >= 40) {\n  tier = \"🌡 Warm Lead\";\n}\n\n// Return new object\nreturn [\n  {\n    json: {\n      vid: data.vid,\n      firstname: props.firstname?.value || \"\",\n      lastname: props.lastname?.value || \"\",\n      email: email,\n      phone: props.phone?.value || props.mobilephone?.value || \"\",\n      company: props.company?.value || data[\"associated-company\"]?.properties?.name?.value || \"\",\n      leadScore: score,\n      leadTier: tier\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        -272
      ],
      "id": "87aa9fa8-dbf5-4ac9-8390-d47281b10a64",
      "name": "Lead Scoring"
    }
  ],
  "pinData": {},
  "connections": {
    "Typeform Trigger": {
      "main": [
        [
          {
            "node": "Search HubSpot Contact",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search HubSpot Contact": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Create a contact",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update a contact",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a contact": {
      "main": [
        [
          {
            "node": "Lead Scoring",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a contact": {
      "main": [
        [
          {
            "node": "Lead Scoring",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lead Scoring": {
      "main": [
        [
          {
            "node": "Slack Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3c1f0029-c198-4eec-ad38-e2ded34d8eb8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "af9fe5bb0163dc4cbb85dd6fb4c45fe63eac1327996aeecd696d8f7aed2d776b"
  },
  "id": "pumwEPWeFsd4e4bH",
  "tags": [
    {
      "createdAt": "2025-09-17T14:03:02.830Z",
      "updatedAt": "2025-09-17T14:03:02.830Z",
      "id": "2NkzObIEB4iMdLVY",
      "name": "hubspot"
    },
    {
      "createdAt": "2025-09-17T14:03:14.663Z",
      "updatedAt": "2025-09-17T14:03:14.663Z",
      "id": "LrL4trxuSGhOMJqT",
      "name": "lead scoring"
    },
    {
      "createdAt": "2025-09-17T14:02:53.075Z",
      "updatedAt": "2025-09-17T14:02:53.075Z",
      "id": "QFXr1YBk4kmh4Msw",
      "name": "lead capture"
    },
    {
      "createdAt": "2025-09-17T14:03:19.416Z",
      "updatedAt": "2025-09-17T14:03:19.416Z",
      "id": "vOUsSt8VEcAevoCs",
      "name": "slack"
    }
  ]
}